{% extends "base.html" %}
{% block title %}Регистрация | Аренда автомобилей | Колеса свободы{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
{% endblock %}
{% block content %}

<!-- Секция регистрации с новым дизайном -->
<section class="registration-section">
    <div class="registration-container">
        <h1>Регистрация</h1>
        
        <!-- Сообщение об ошибке -->
        <div id="error-message" class="error-message" style="display: none;"></div>
        
        <form id="registerForm" class="registration-form" onsubmit="handleRegister(event)">
            <div class="form-group">
                <label for="first_name">Имя:</label>
                <input type="text" id="first_name" name="first_name" required placeholder="Введите ваше имя">
            </div>

            <div class="form-group">
                <label for="last_name">Фамилия:</label>
                <input type="text" id="last_name" name="last_name" required placeholder="Введите вашу фамилию">
            </div>

            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required placeholder="example@mail.com">
            </div>

            <div class="form-group">
                <label for="phone">Телефон:</label>
                <input type="tel" id="phone" name="phone" required placeholder="+7 (___) ___-__-__">
            </div>

            <div class="form-group">
                <label for="password">Пароль:</label>
                <input type="password" id="password" name="password" required placeholder="Минимум 8 символов">
            </div>

            <button type="submit">Зарегистрироваться</button>
        </form>

        <div class="login-link">
            Уже есть аккаунт? <a href="/login">Войти</a>
        </div>
    </div>
</section>

<script>
async function handleRegister(event) {
    event.preventDefault();
    const formData = {
        first_name: document.getElementById('first_name').value,
        last_name: document.getElementById('last_name').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value,
        password: document.getElementById('password').value
    };
    
    const errorMessage = document.getElementById('error-message');
    
    try {
        const response = await fetch('/api/register', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (response.ok) {
            // Регистрация успешна, перенаправляем на страницу входа
            window.location.href = '/login';
        } else {
            errorMessage.textContent = data.error || 'Ошибка при регистрации';
            errorMessage.style.display = 'block';
        }
    } catch (error) {
        errorMessage.textContent = 'Ошибка сервера';
        errorMessage.style.display = 'block';
    }
}
</script>

{% endblock %}